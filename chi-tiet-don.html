<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Chi tiết đơn đặt sân - SportField</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <style>
    .page-header {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      padding: 32px 0;
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    .order-card {
      background: var(--white);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 24px;
      margin-bottom: 24px;
    }

    .order-id {
      background: #f3f4f6;
      padding: 12px 16px;
      border-radius: 8px;
      font-family: monospace;
      font-weight: 600;
      margin-bottom: 24px;
      font-size: 15px;
    }

    .order-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      gap: 16px;
    }

    .order-row:last-child {
      border-bottom: none;
    }

    .order-label {
      font-size: 13px;
      color: var(--muted);
      flex-shrink: 0;
    }

    .order-value {
      font-weight: 600;
      text-align: right;
    }

    .order-value a {
      color: var(--green-dark);
      text-decoration: none;
    }

    .order-value a:hover {
      text-decoration: underline;
    }

    .order-status {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
    }

    .order-status.confirmed {
      background: #dcfce7;
      color: #166534;
    }

    .order-status.completed {
      background: #e0e7ff;
      color: #3730a3;
    }

    .order-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .order-actions .btn,
    .order-actions .btn-outline {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      text-decoration: none;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 999px;
      white-space: nowrap;
    }

    .order-actions .btn-outline {
      background: transparent;
      color: var(--green-dark);
      border: 1.5px solid rgba(22, 163, 74, 0.5);
    }

    .order-actions .btn-outline:hover {
      background: rgba(22, 163, 74, 0.08);
      border-color: var(--green);
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      color: var(--green);
      font-weight: 600;
      font-size: 14px;
    }

    .back-link:hover {
      color: var(--green-dark);
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-inner">
      <div class="logo-wrap">
        <a href="index.html">
          <svg class="logo-icon" viewBox="0 0 64 64" aria-hidden="true">
            <defs>
              <linearGradient id="sf-pin" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#16a34a" />
                <stop offset="100%" stop-color="#15803d" />
              </linearGradient>
            </defs>
            <path d="M32 4C22 4 14 12 14 22.2c0 11.2 9.7 22.3 16.2 30 1 1.2 2.7 1.2 3.7 0C40.3 44.5 50 33.4 50 22.2 50 12 42 4 32 4Z" fill="none" stroke="url(#sf-pin)" stroke-width="4" />
            <path d="M18 26h28" stroke="#16a34a" stroke-width="3" stroke-linecap="round" />
            <path d="M32 26v16" stroke="#16a34a" stroke-width="3" stroke-linecap="round" />
            <path d="M24 18l5 5 9-9" fill="none" stroke="#2563eb" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <div class="brand-name">SportField</div>
        </a>
      </div>

      <nav>
        <a href="index.html">Trang chủ</a>
        <div class="nav-dropdown">
          <a href="danh-sach-san.html">Môn thể thao</a>
          <div class="dropdown-menu">
            <a href="danh-sach-san.html?sportType=football">Bóng đá</a>
            <a href="danh-sach-san.html?sportType=badminton">Cầu lông</a>
            <a href="danh-sach-san.html?sportType=tennis">Tennis</a>
          </div>
        </div>
        <a href="ban-do-san.html">Bản đồ sân</a>
        <a href="uu-dai.html">Ưu đãi</a>
        <a href="doi-tac.html">Dành cho đối tác</a>
        <a href="tin-tuc.html">Tin tức</a>
        <div class="nav-dropdown">
          <a href="ho-tro.html">Hỗ trợ</a>
          <div class="dropdown-menu">
            <a href="ho-tro.html">Hỗ trợ & FAQ</a>
            <a href="huong-dan.html">Video hướng dẫn</a>
            <a href="dieu-khoan.html">Điều khoản sử dụng</a>
          </div>
        </div>
      </nav>

      <div class="header-cta">
        <a href="tai-khoan.html" class="btn-outline">Tài khoản</a>
      </div>
    </div>
  </header>

  <main>
    <div class="page-header">
      <div class="container">
        <nav class="breadcrumb" style="margin-bottom: 12px; font-size: 13px;">
          <a href="index.html">Trang chủ</a> /
          <a href="tai-khoan.html">Tài khoản</a> /
          <a href="lich-su-dat.html">Lịch sử đặt sân</a> /
          <span style="color: rgba(255,255,255,0.9);">Chi tiết đơn</span>
        </nav>
        <div class="page-title" id="page-title">Chi tiết đơn đặt sân</div>
        <div class="page-subtitle" id="page-subtitle">Thông tin đơn đặt sân của bạn</div>
      </div>
    </div>

    <div class="container">
      <a href="lich-su-dat.html" class="back-link">← Quay lại Lịch sử đặt sân</a>

      <div id="content-area">
        <div style="text-align: center; padding: 40px; color: var(--muted);">Đang tải...</div>
      </div>
    </div>
  </main>

  <button id="back-to-top" class="back-to-top" onclick="scrollToTop()" aria-label="Lên đầu trang">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 15l-6-6-6 6"/>
    </svg>
  </button>

  <footer>
    <div class="container">
      <div class="footer-grid">
        <div>
          <div class="footer-logo">
            <svg class="logo-icon" viewBox="0 0 64 64" aria-hidden="true">
              <defs>
                <linearGradient id="sf-pin-footer" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#16a34a" />
                  <stop offset="100%" stop-color="#15803d" />
                </linearGradient>
              </defs>
              <path d="M32 4C22 4 14 12 14 22.2c0 11.2 9.7 22.3 16.2 30 1 1.2 2.7 1.2 3.7 0C40.3 44.5 50 33.4 50 22.2 50 12 42 4 32 4Z" fill="none" stroke="url(#sf-pin-footer)" stroke-width="4" />
              <path d="M18 26h28" stroke="#16a34a" stroke-width="3" stroke-linecap="round" />
              <path d="M32 26v16" stroke="#16a34a" stroke-width="3" stroke-linecap="round" />
              <path d="M24 18l5 5 9-9" fill="none" stroke="#2563eb" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="brand-name">SportField</span>
          </div>
          <p class="section-sub">
            Nền tảng đặt sân thể thao đa môn, giúp bạn kết nối dễ dàng với hàng trăm sân tập trên toàn quốc.
          </p>
        </div>
        <div>
          <div class="footer-title">Quy định & hỗ trợ</div>
          <div class="footer-links">
            <a href="dieu-khoan.html">Điều khoản sử dụng</a>
            <a href="dieu-khoan.html#privacy">Chính sách bảo mật</a>
            <a href="ho-tro.html">Hướng dẫn đặt sân</a>
            <a href="ho-tro.html">Hỗ trợ khách hàng</a>
          </div>
        </div>
        <div>
          <div class="footer-title">Liên hệ</div>
          <div class="footer-links">
            <span>Email: support@sportfield.vn</span>
            <span>Hotline: 0900 000 000</span>
            <span>Giờ làm việc: 8:00 – 22:00</span>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <span>© 2025 SportField. All rights reserved.</span>
        <span>Made with ❤️ for sport lovers.</span>
      </div>
    </div>
  </footer>

  <script src="assets/js/mockData.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/header.js"></script>
  <script src="assets/js/backToTop.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      const urlParams = new URLSearchParams(window.location.search);
      const bookingId = urlParams.get('id');
      const content = document.getElementById('content-area');

      if (!bookingId) {
        content.innerHTML = `
          <div class="order-card">
            <p style="text-align: center; color: var(--muted); margin-bottom: 16px;">Không tìm thấy đơn đặt sân.</p>
            <a href="lich-su-dat.html" class="btn">Xem lịch sử đặt sân</a>
          </div>
        `;
        return;
      }

      const user = await getCurrentUser();
      const booking = await getBookingById(bookingId);

      if (!booking) {
        content.innerHTML = `
          <div class="order-card">
            <p style="text-align: center; color: var(--muted); margin-bottom: 16px;">Không tìm thấy đơn đặt sân.</p>
            <a href="lich-su-dat.html" class="btn">Xem lịch sử đặt sân</a>
          </div>
        `;
        return;
      }

      if (user && booking.userId !== user.id) {
        content.innerHTML = `
          <div class="order-card">
            <p style="text-align: center; color: var(--muted); margin-bottom: 16px;">Bạn không có quyền xem đơn này.</p>
            <a href="lich-su-dat.html" class="btn">Xem lịch sử đặt sân</a>
          </div>
        `;
        return;
      }

      const date = new Date(booking.date);
      const dateStr = date.toLocaleDateString('vi-VN');
      const timeRange = booking.timeSlots && booking.timeSlots.length
        ? `${booking.timeSlots[0]} - ${booking.timeSlots[booking.timeSlots.length - 1]}`
        : '-';
      const hours = booking.timeSlots ? booking.timeSlots.length : 0;
      const totalStr = new Intl.NumberFormat('vi-VN').format(booking.totalPrice) + '₫';
      const codeStr = 'SF-2025-' + String(booking.id).padStart(6, '0');
      const now = new Date();
      const isPast = date < now;
      const statusText = isPast ? 'Đã hoàn thành' : 'Đã xác nhận';
      const statusClass = isPast ? 'completed' : 'confirmed';

      content.innerHTML = `
        <div class="order-card">
          <div class="order-id">Mã đặt sân: ${codeStr}</div>
          <div class="order-row">
            <span class="order-label">Sân</span>
            <span class="order-value"><a href="chi-tiet-san.html?id=${booking.venueId}">${booking.venueName}</a></span>
          </div>
          <div class="order-row">
            <span class="order-label">Sân con</span>
            <span class="order-value">${booking.field || 'Sân 1'}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Ngày</span>
            <span class="order-value">${dateStr}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Khung giờ</span>
            <span class="order-value">${timeRange}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Số giờ</span>
            <span class="order-value">${hours} giờ</span>
          </div>
          <div class="order-row">
            <span class="order-label">Tổng thanh toán</span>
            <span class="order-value">${totalStr}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Trạng thái</span>
            <span class="order-value"><span class="order-status ${statusClass}">${statusText}</span></span>
          </div>
          <div class="order-actions">
            <a href="bang-lich-trong.html?venue=${booking.venueId}" class="btn">Đặt lại sân này</a>
            <a href="chi-tiet-san.html?id=${booking.venueId}" class="btn-outline">Xem chi tiết sân</a>
            ${isPast ? `<a href="danh-gia-san.html?id=${booking.venueId}" class="btn-outline">Đánh giá sân</a>` : ''}
          </div>
        </div>
      `;
    });

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>
